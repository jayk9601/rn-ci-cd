# name: Build & upload to Firebase App Distribution

# on:
#   push:
#     branches:
#       - upload_to_firebase

# jobs:
#   install-and-test:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v3

#       - name: Install Node modules
#         run: yarn ci

#       - name: Cache Gradle Wrapper
#         uses: actions/cache@v3
#         with:
#          path: ~/.gradle/wrapper
#          key: ${{ runner.os }}-gradle-wrapper-${{ hashFiles('gradle/wrapper/gradle-wrapper.properties') }}

#       - name: Cache Gradle Dependencies
#         uses: actions/cache@v3
#         with:
#          path: ~/.gradle/caches
#          key: ${{ runner.os }}-gradle-caches-${{ hashFiles('gradle/wrapper/gradle-wrapper.properties') }}
#          restore-keys: ${{ runner.os }}-gradle-caches-

#   build-android:
#     needs: install-and-test
#     runs-on: ubuntu-latest
#     steps: 
#       - uses: actions/checkout@v3

#       - name: Install Node modules
#         run: yarn ci

#       - name: Make Gradlew Executable
#         run: cd android && chmod +x ./gradlew

#       - name: clean build folder
#         run: cd android && ./gradlew clean
        
#       - name: Build Android Release
#         run: cd android && ./gradlew assembleRelease

#       - name: Upload Artifact
#         uses: actions/upload-artifact@v3
#         with:
#           name: android cicd
#           path: android/app/build/outputs/apk/release/app-release.apk

        
#   upload-android:
#      needs: build-android
#      runs-on: ubuntu-latest
#      steps:
#         - name: upload artifact to Firebase App Distribution
#           uses: wzieba/Firebase-Distribution-Github-Action@v1
#           with:
#             appId: ${{secrets.FIREBASE_APP_ID}}
#             serviceCredentialsFileContent: ${{ secrets.CREDENTIAL_FILE_CONTENT }}
#             groups: tester
#             file: android/app/build/outputs/apk/release/app-release.apk
#       #  - name: GitHub Action for Firebase
#       #    uses: w9jds/firebase-action@v11.24.1
#       #    with:
#       #      appId: ${{secrets.FIREBASE_APP_ID}}
#       #      serviceCredentialsFileContent: ${{ secrets.CREDENTIAL_FILE_CONTENT }}
#       #      groups: android_testers
#       #      file: android/app/build/outputs/apk/release/app-release.apk
   
name: Build & upload to Firebase App Distribution 

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    # - name: set up JDK 1.8
    #   uses: actions/setup-java@v1
    #   with:
    #     java-version: 1.8
    - name: Install Node modules
      run: yarn ci
    - name: Make Gradlew Executable
      run: cd android && chmod +x ./gradlew
    - name: build release 
      run: cd android && ./gradlew assembleRelease
    - name: upload artifact to Firebase App Distribution
      uses: wzieba/Firebase-Distribution-Github-Action@v1
      with:
        appId: ${{secrets.FIREBASE_APP_ID}}
        serviceCredentialsFileContent: ${{ secrets.CREDENTIAL_FILE_CONTENT }}
        groups: testers
        file: android/app/build/outputs/apk/release/app-release-unsigned.apk
  